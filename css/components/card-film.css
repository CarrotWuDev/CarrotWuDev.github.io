/* 电影票卡片 (Neo-Brutalism + Ticket Metaphor) v2.1 */
.card-film {
    /* 核心参数 */
    --stub-width: 140px;
    --hole-size: 20px;
    --hole-radius: calc(var(--hole-size) / 2);
    --ticket-bg: var(--film-ticket-bg);
    --border-width: 2px;
    /* 与 .card 边框宽度保持一致 */
    --card-accent: var(--accent-film);
    /* 电影专属强调色 */

    /* 覆盖 Base Card 设置 */
    display: flex;
    /* 覆盖 .card 的 display:grid */
    position: relative;


    /* 重置基础卡片样式，电影卡片使用独立的布局结构 */
    background: transparent;
    border: none;
    padding: 0;

    box-shadow: none;
    transition: none;

    /* 布局修复: 默认跨两列以保证票面宽度 */
    /* 注意: .cards 定义了 grid-template-columns: repeat(auto-fill, ...).
       span 2 会让它占据两个卡片位 */
    grid-column: span 2;
    /* 覆盖 card 的 grid-row: span 6; 让高度自适应内容，或是保持 span 6 但内容撑开轨道 */
    grid-row: auto;
}

/* 绘制整个票形容器 */
.card-film-container {
    display: flex;
    flex-direction: row;
    /* 默认横向 */
    width: 100%;
    height: 100%;
    background: var(--ticket-bg);
    border: var(--border-width) solid var(--film-ticket-border);
    position: relative;

    /* Masking for Holes */
    --mask-position-x: calc(var(--stub-width));

    -webkit-mask-image:
        radial-gradient(circle at var(--mask-position-x) 0, transparent var(--hole-radius), black calc(var(--hole-radius) + 0.5px)),
        radial-gradient(circle at var(--mask-position-x) 100%, transparent var(--hole-radius), black calc(var(--hole-radius) + 0.5px));

    -webkit-mask-size: 100% 51%;
    -webkit-mask-position: top, bottom;
    -webkit-mask-repeat: no-repeat;

    mask-image:
        radial-gradient(circle at var(--mask-position-x) 0, transparent var(--hole-radius), black calc(var(--hole-radius) + 0.5px)),
        radial-gradient(circle at var(--mask-position-x) 100%, transparent var(--hole-radius), black calc(var(--hole-radius) + 0.5px));

    mask-size: 100% 51%;
    mask-position: top, bottom;
    mask-repeat: no-repeat;

    /* 边框过渡效果 */
    transition: border-color var(--duration-fast);
}

/* 悬浮状态：阴影和边框变化 */
.card-film:hover {

    box-shadow: none;
}

.card-film:hover .card-film-container {
    border-color: var(--card-accent);
}

/* --- 分割线 --- */
/* 
 * 对齐说明：
 * 
 * 水平方向 (left)：
 * - mask-image 的圆心位置相对于 border-box（含边框）
 * - absolute 定位的 left 相对于 padding-box（不含边框）
 * - 需减去边框宽度以补偿参照系差异，确保分割线精确穿过缺口圆心
 * 
 * 垂直方向 (top/bottom)：
 * - 半圆缺口圆心位于容器顶部/底部边缘（Y=0 / Y=100%）
 * - 半圆半径为 --hole-radius，因此缺口边缘距容器边缘 = --hole-radius
 * - 分割线的 top/bottom 设为 --hole-radius，使端点正好接触缺口边缘
 */
.card-film-divider {
    position: absolute;
    left: calc(var(--stub-width) - var(--border-width));
    top: var(--hole-radius);
    bottom: var(--hole-radius);
    width: 0;
    border-left: 2px dashed var(--film-ticket-divider);
    z-index: 5;
}

/* --- Left Stub --- */
/* 
 * 对齐说明：
 * - mask-image 的圆心位置相对于 border-box（含边框）
 * - 内部 flex 子元素在 padding-box 内布局（不含边框）
 * - 需减去边框宽度以补偿参照系差异，确保封面右边缘精确对齐缺口圆心
 */
.film-stub {
    width: calc(var(--stub-width) - var(--border-width));
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
}

.film-poster {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: grayscale(100%);
    transition: transform 0.3s ease, filter 0.3s ease;
}

.card-film:hover .film-poster {
    transform: scale(1.03);
    filter: grayscale(0%);
}

.film-status {
    position: absolute;
    top: 15px;
    left: -5px;
    background: var(--card-accent);
    color: var(--film-title-color);
    font-family: var(--font-mono);
    font-weight: 900;
    font-size: 0.8rem;
    text-transform: uppercase;
    padding: 4px 12px;
    border: 2px solid var(--film-ticket-border);
    transform: rotate(-15deg);
    will-change: transform;
    box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
    z-index: 6;
}

/* --- Right Main --- */
.film-main {
    flex-grow: 1;
    padding: 24px 32px;
    display: flex;
    flex-direction: column;
    min-width: 0;
}

.film-title {
    font-size: 1.8rem;
    font-weight: 900;
    margin: 0 0 8px 0;
    line-height: 1.1;
    color: var(--film-title-color);
    transition: color 0.15s ease;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.card-film:hover .film-title {
    color: var(--card-accent);
}

.film-meta-row {
    font-family: var(--font-mono);
    color: var(--film-meta-color);
    font-size: 0.9rem;
    margin-bottom: 20px;
    display: flex;
    gap: 12px;
    align-items: center;
}

.film-credits {
    display: grid;
    gap: 6px;
    margin-bottom: 20px;
    font-size: 0.9rem;
    font-weight: 400;
    color: var(--fg);
}

.film-credit-line {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.5;
}

.film-credit-line strong {
    font-weight: 700;
    font-size: 0.9rem;
    margin-right: 4px;
    color: var(--fg);
}

.film-credit-line.film-director {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.film-credit-line.film-starring {
    white-space: normal;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    min-height: 3em;
    /* 2 lines * 1.5 */
}

.film-review {
    background: var(--bg-subtle);
    padding: 10px 12px;
    font-size: 13px;
    font-style: italic;
    color: var(--muted);
    line-height: 1.5;
    border-left: 3px solid var(--line);
    transition: border-color .15s;
    margin-bottom: 20px;
}

.film-review p {
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    min-height: 3em;
    /* 2 lines * 1.5 */
}

.card-film:hover .film-review {
    border-color: var(--card-accent);
}

.film-footer {
    margin-top: auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
}

.film-tags {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}

.film-tags .tag {
    background: var(--bg);
    color: var(--fg);
    border: 2px solid var(--line);
    font-size: 12px;
    padding: 4px 10px;
    box-shadow: 2px 2px 0 var(--shadow);
}

.card-film:hover .film-tags .tag {
    border-color: var(--card-accent);
}

.btn-douban {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 13px;
    font-weight: 600;
    color: var(--muted);
    text-decoration: none;
    transition: color var(--duration-fast);
    white-space: nowrap;
}

.btn-douban::after {
    content: '→';
}

.btn-douban:hover {
    color: var(--card-accent);
}

/* ====== Mobile / Tablet Portrait (< 768px) ====== */
/* 当屏幕较窄，无法容纳宽票根时，切换为垂直堆叠布局 */
@media (max-width: 900px) {

    /* 稍微调大断点，确保在中等屏幕也不挤 */
    .card-film {
        grid-column: span 1;
        /* 恢复单列 */
        min-height: auto;
    }

    .card-film-container {
        flex-direction: column;
        /* 移动端移除 Mask 或改为垂直 Mask? 
           为简化，移动端移除 Mask 和中间分割线，变为上下结构 */
        -webkit-mask-image: none;
        mask-image: none;
    }

    .card-film-divider {
        display: none;
    }

    .film-stub {
        width: 100%;
        height: 200px;
        /* 固定高度的海报区 */
        border-bottom: 2px dashed var(--film-ticket-divider);
        /* 移动端改为水平分割线 */
    }

    .film-main {
        padding: 20px;
    }

    .film-title {
        font-size: 1.5rem;
    }

    .btn-douban {
        width: 100%;
        /* 按钮全宽 */
        justify-content: center;
    }

    .film-footer {
        flex-direction: column;
        align-items: stretch;
    }
}